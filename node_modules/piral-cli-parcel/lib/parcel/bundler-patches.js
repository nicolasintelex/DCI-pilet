"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.standardPatches = void 0;
const path_1 = require("path");
const utils_1 = require("piral-cli/utils");
const windowOrGlobal = '(typeof window !== "undefined" ? window : global)';
async function replaceAll(dir, file, original, replacement) {
    const content = await (0, utils_1.readText)(dir, file);
    if (content && content.indexOf(original) !== -1) {
        await (0, utils_1.writeText)(dir, file, content.split(original).join(replacement));
    }
}
exports.standardPatches = {
    async buffer(rootDir) {
        await replaceAll(rootDir, 'index.js', ' global.', ` ${windowOrGlobal}.`);
    },
    async 'has-symbols'(rootDir) {
        await replaceAll(rootDir, 'index.js', ' global.', ` ${windowOrGlobal}.`);
    },
    async ketting(rootDir) {
        const util = (0, path_1.resolve)(rootDir, 'dist', 'util');
        const utils = (0, path_1.resolve)(rootDir, 'dist', 'utils');
        await replaceAll(util, 'fetch-helper.js', 'global', windowOrGlobal);
        await replaceAll(utils, 'fetch-helper.js', 'global', windowOrGlobal);
        await replaceAll(utils, 'fetch-polyfill.js', 'global', windowOrGlobal);
    },
};
//# sourceMappingURL=bundler-patches.js.map